<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>AccessPulse | IT Audit Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .modal-overlay {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(4px);
        }
    </style>
</head>

<body class="bg-gray-100 p-10 font-sans">
    <div class="max-w-6xl mx-auto">

        <div class="bg-white p-8 rounded-t-xl shadow-md border-b border-gray-100">
            <div class="flex justify-between items-center mb-8">
                <div>
                    <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">AccessPulse</h1>
                    <p class="text-slate-500 font-medium">IT Access Control Center</p>
                </div>
                <button onclick="exportData()"
                    class="bg-slate-800 text-white px-5 py-2.5 rounded-lg text-sm font-bold hover:bg-slate-700 transition shadow-lg">Export
                    CSV</button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-blue-50 border border-blue-100 p-5 rounded-xl text-center">
                    <p class="text-blue-600 text-xs font-bold uppercase mb-1">Total Logs</p>
                    <p id="statTotal" class="text-3xl font-black text-blue-900">0</p>
                </div>
                <div class="bg-green-50 border border-green-100 p-5 rounded-xl text-center">
                    <p class="text-green-600 text-xs font-bold uppercase mb-1">Active</p>
                    <p id="statActive" class="text-3xl font-black text-green-900">0</p>
                </div>
                <div class="bg-red-50 border border-red-100 p-5 rounded-xl text-center">
                    <p class="text-red-600 text-xs font-bold uppercase mb-1">Revoked</p>
                    <p id="statRevoked" class="text-3xl font-black text-red-900">0</p>
                </div>
            </div>

            <div class="flex flex-wrap gap-3">
                <input id="searchInput" onkeyup="renderLogs()" type="text" placeholder="Search Employee or App..."
                    class="flex-grow min-w-[300px] px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none transition">
                <select id="deptFilter" onchange="renderLogs()"
                    class="bg-gray-50 border border-gray-200 px-4 py-3 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 text-slate-600">
                    <option value="">All Departments</option>
                    <option value="IT">IT</option>
                    <option value="Engineering">Engineering</option>
                    <option value="Marketing">Marketing</option>
                    <option value="HR">HR</option>
                </select>
                <select id="timeFilter" onchange="renderLogs()"
                    class="bg-gray-50 border border-gray-200 px-4 py-3 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 text-slate-600">
                    <option value="all">All Time</option>
                    <option value="7days">Last 7 Days</option>
                </select>
            </div>
        </div>

        <div class="bg-slate-900 p-6 shadow-md border-x border-slate-800">
            <h2 class="text-blue-400 text-[10px] font-black uppercase tracking-[0.2em] mb-4">Secure Provisioning Form
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-5 gap-3">
                <input id="userName" type="text" placeholder="Employee Name"
                    class="bg-slate-800 text-white border border-slate-700 p-3 rounded-lg outline-none focus:border-blue-500">
                <select id="userDept"
                    class="bg-slate-800 text-white border border-slate-700 p-3 rounded-lg outline-none focus:border-blue-500">
                    <option value="" disabled selected>Department</option>
                    <option value="IT">IT</option>
                    <option value="Engineering">Engineering</option>
                    <option value="Marketing">Marketing</option>
                    <option value="HR">HR</option>
                </select>
                <input id="appName" type="text" placeholder="Application"
                    class="bg-slate-800 text-white border border-slate-700 p-3 rounded-lg outline-none focus:border-blue-500">
                <input id="authBy" type="text" placeholder="Authorized By"
                    class="bg-slate-800 text-white border border-slate-700 p-3 rounded-lg outline-none focus:border-blue-500">
                <button onclick="grantAccess()"
                    class="bg-blue-600 text-white p-3 rounded-lg font-bold hover:bg-blue-500 transition shadow-lg">Grant
                    Access</button>
            </div>
        </div>

        <div class="bg-white rounded-b-xl shadow-xl overflow-hidden min-h-[300px]">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr
                        class="bg-slate-50 border-b border-gray-200 text-slate-400 text-[10px] uppercase font-black tracking-widest">
                        <th class="p-5">Identity & Dept</th>
                        <th class="p-5">Resource</th>
                        <th class="p-5">Grant Audit</th>
                        <th class="p-5">Revocation Audit</th>
                        <th class="p-5 text-center">Lifecycle</th>
                    </tr>
                </thead>
                <tbody id="logTable" class="divide-y divide-gray-100"></tbody>
            </table>
            <div id="noResults" class="hidden p-20 text-center text-gray-400 font-medium italic">No matches found for
                current filters.</div>
        </div>
    </div>

    <div id="revokeModal" class="hidden fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full p-8 transform transition-all scale-100">
            <div class="w-12 h-12 bg-red-100 text-red-600 rounded-full flex items-center justify-center mb-4 mx-auto">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-width="2"
                        d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z">
                    </path>
                </svg>
            </div>
            <h3 class="text-xl font-bold text-slate-900 text-center mb-2">Confirm Revocation</h3>
            <p class="text-slate-500 text-center text-sm mb-6">Enter your name to confirm the de-provisioning of this
                resource.</p>
            <input id="revokerName" type="text" placeholder="Your Admin Name"
                class="w-full border-2 border-slate-100 p-3 rounded-xl mb-4 outline-none focus:border-red-500 text-center font-bold">
            <div class="flex gap-3">
                <button onclick="closeModal()"
                    class="flex-1 px-4 py-3 text-slate-500 font-bold hover:bg-slate-50 rounded-xl transition">Cancel</button>
                <button onclick="confirmRevoke()"
                    class="flex-1 px-4 py-3 bg-red-600 text-white font-bold rounded-xl hover:bg-red-700 transition shadow-lg shadow-red-200">Confirm</button>
            </div>
        </div>
    </div>

    <script>
        let logs = JSON.parse(localStorage.getItem('accessPulseLogs')) || [];
        let activeRevokeIndex = null;

        function updateStats() {
            document.getElementById('statTotal').innerText = logs.length;
            document.getElementById('statActive').innerText = logs.filter(l => l.status === 'Active').length;
            document.getElementById('statRevoked').innerText = logs.filter(l => l.status === 'Revoked').length;
        }

        function renderLogs() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const deptTerm = document.getElementById('deptFilter').value;
            const timeTerm = document.getElementById('timeFilter').value;
            const tbody = document.getElementById('logTable');
            const noResults = document.getElementById('noResults');

            updateStats();

            const now = new Date();
            const filteredLogs = logs.filter(log => {
                const matchesSearch = log.user.toLowerCase().includes(searchTerm) || log.app.toLowerCase().includes(searchTerm);
                const matchesDept = deptTerm === "" || log.dept === deptTerm;
                let matchesTime = true;
                if (timeTerm === '7days') {
                    const diffDays = (now - new Date(log.timestamp)) / (1000 * 60 * 60 * 24);
                    matchesTime = diffDays <= 7;
                }
                return matchesSearch && matchesDept && matchesTime;
            });

            if (filteredLogs.length === 0) {
                noResults.classList.remove('hidden');
                tbody.innerHTML = '';
            } else {
                noResults.classList.add('hidden');
                tbody.innerHTML = filteredLogs.map((log) => {
                    const originalIndex = logs.indexOf(log);
                    return `
                    <tr class="hover:bg-slate-50 transition">
                        <td class="p-5">
                            <div class="font-bold text-slate-800">${log.user}</div>
                            <div class="text-[10px] font-black text-blue-600 uppercase tracking-tighter">${log.dept}</div>
                        </td>
                        <td class="p-5"><span class="px-2 py-1 rounded-md text-[10px] font-black bg-slate-100 text-slate-600 border border-slate-200 uppercase">${log.app}</span></td>
                        <td class="p-5">
                            <div class="text-xs font-bold text-slate-700">${log.authorizedBy}</div>
                            <div class="text-[10px] text-slate-400 font-mono">${log.date}</div>
                        </td>
                        <td class="p-5">
                            ${log.revokedBy ? `
                                <div class="text-xs font-bold text-red-600">${log.revokedBy}</div>
                                <div class="text-[10px] text-slate-400 font-mono">${log.revokeDate}</div>
                            ` : '<span class="text-slate-200">â€”</span>'}
                        </td>
                        <td class="p-5 text-center">
                            ${log.status === 'Active'
                            ? `<button onclick="openModal(${originalIndex})" class="bg-white border-2 border-red-100 text-red-600 px-4 py-1.5 rounded-lg text-xs font-black hover:bg-red-600 hover:text-white transition shadow-sm">REVOKE</button>`
                            : `<span class="px-2.5 py-0.5 rounded-full text-[10px] font-black bg-gray-100 text-gray-400 uppercase">Inactive</span>`
                        }
                        </td>
                    </tr>`;
                }).reverse().join('');
            }
            localStorage.setItem('accessPulseLogs', JSON.stringify(logs));
        }

        function grantAccess() {
            const user = document.getElementById('userName').value;
            const dept = document.getElementById('userDept').value;
            const app = document.getElementById('appName').value;
            const auth = document.getElementById('authBy').value;
            if (!user || !dept || !app || !auth) return alert("Security: All fields required.");

            logs.push({
                user, dept, app, authorizedBy: auth,
                timestamp: new Date().getTime(),
                date: new Date().toLocaleString(),
                status: 'Active',
                revokedBy: null, revokeDate: null
            });
            document.getElementById('userName').value = '';
            document.getElementById('appName').value = '';
            renderLogs();
        }

        // Modal Logic
        function openModal(index) {
            activeRevokeIndex = index;
            document.getElementById('revokeModal').classList.remove('hidden');
            document.getElementById('revokerName').focus();
        }

        function closeModal() {
            document.getElementById('revokeModal').classList.add('hidden');
            document.getElementById('revokerName').value = '';
            activeRevokeIndex = null;
        }

        function confirmRevoke() {
            const name = document.getElementById('revokerName').value;
            if (!name) return alert("Audit Name required.");

            logs[activeRevokeIndex].status = 'Revoked';
            logs[activeRevokeIndex].revokedBy = name;
            logs[activeRevokeIndex].revokeDate = new Date().toLocaleString();

            closeModal();
            renderLogs();
        }

        function exportData() {
            let csv = "User,Dept,App,AuthorizedBy,Date,Status,RevokedBy,RevokedDate\n";
            logs.forEach(l => csv += `"${l.user}","${l.dept}","${l.app}","${l.authorizedBy}","${l.date}","${l.status}","${l.revokedBy || ''}","${l.revokeDate || ''}"\n`);
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('href', url); a.setAttribute('download', 'access_audit.csv');
            a.click();
        }

        renderLogs();
    </script>
</body>

</html>